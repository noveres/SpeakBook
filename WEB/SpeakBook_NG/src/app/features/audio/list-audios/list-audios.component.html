<div class="audio-list-container">
    <!-- 頁面標題 -->
    <div class="page-header">
        <h1>音訊管理</h1>
        <p class="subtitle">管理和上傳教材音訊檔案</p>
    </div>

    <!-- 搜尋和上傳區域 -->
    <div class="toolbar">
        <!-- 搜尋欄 -->
        <div class="search-box">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
            <input type="text" [(ngModel)]="searchKeyword" (keyup.enter)="onSearch()" placeholder="搜尋音訊檔案名稱..."
                class="search-input" />
            <button *ngIf="searchKeyword" (click)="onClearSearch()" class="clear-btn" title="清除搜尋">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <button (click)="onSearch()" class="search-btn">搜尋</button>
        </div>

        <!-- 上傳按鈕 -->
        <div class="upload-section">
            <input type="file" #fileInput (change)="onFileSelected($event)" accept="audio/*" style="display: none;" />
            <button (click)="fileInput.click()" class="upload-btn" [disabled]="isUploading">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="17 8 12 3 7 8"></polyline>
                    <line x1="12" y1="3" x2="12" y2="15"></line>
                </svg>
                {{ isUploading ? '上傳中...' : '上傳音訊' }}
            </button>
        </div>
    </div>

    <!-- 載入狀態 -->
    <div *ngIf="isLoading" class="loading-container">
        <div class="spinner"></div>
        <p>載入中...</p>
    </div>

    <!-- 音訊列表 -->
    <div *ngIf="!isLoading && hasAudios" class="audio-list">
        <div *ngFor="let audio of audios" class="audio-item" [class.playing]="isPlaying(audio.id)">
            <div class="audio-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9 18V5l12-2v13"></path>
                    <circle cx="6" cy="18" r="3"></circle>
                    <circle cx="18" cy="16" r="3"></circle>
                </svg>
            </div>

            <div class="audio-info">
                <h3 class="audio-name">{{ audio.originalFileName }}</h3>
                <div class="audio-meta">
                    <span class="meta-item">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="9" y1="9" x2="15" y2="15"></line>
                            <line x1="15" y1="9" x2="9" y2="15"></line>
                        </svg>
                        {{ formatFileSize(audio.fileSize) }}
                    </span>
                    <span class="meta-item" *ngIf="audio.duration">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        {{ formatDuration(audio.duration) }}
                    </span>
                    <span class="meta-item">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                        {{ audio.uploadedAt | date:'yyyy-MM-dd HH:mm' }}
                    </span>
                </div>
                <div class="audio-url">
                    <span class="url-label">URL:</span>
                    <span class="url-text">{{ audio.fileUrl }}</span>
                    <button (click)="copyToClipboard(audio.fileUrl)" class="copy-btn" title="複製 URL">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="audio-actions">
                <button (click)="playAudio(audio)" class="action-btn play-btn" [class.playing]="isPlaying(audio.id)"
                    [title]="isPlaying(audio.id) ? '停止播放' : '播放音訊'">
                    <!-- 播放圖標 -->
                    <svg *ngIf="!isPlaying(audio.id)" xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                        viewBox="0 0 24 24" fill="currentColor">
                        <polygon points="5 3 19 12 5 21 5 3"></polygon>
                    </svg>
                    <!-- 暫停圖標 -->
                    <svg *ngIf="isPlaying(audio.id)" xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                        viewBox="0 0 24 24" fill="currentColor">
                        <rect x="6" y="4" width="4" height="16"></rect>
                        <rect x="14" y="4" width="4" height="16"></rect>
                    </svg>
                </button>
                <button (click)="onDelete(audio)" class="action-btn delete-btn" title="刪除音訊">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- 空狀態 -->
    <div *ngIf="!isLoading && !hasAudios" class="empty-state">
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 18V5l12-2v13"></path>
            <circle cx="6" cy="18" r="3"></circle>
            <circle cx="18" cy="16" r="3"></circle>
        </svg>
        <h2>{{ searchKeyword ? '找不到符合的音訊' : '尚未上傳任何音訊' }}</h2>
        <p>{{ searchKeyword ? '請嘗試其他搜尋關鍵字' : '點擊上方「上傳音訊」按鈕開始上傳' }}</p>
    </div>

    <!-- 分頁 -->
    <div *ngIf="!isLoading && hasAudios && totalPages > 1" class="pagination">
        <button (click)="onPageChange(currentPage - 1)" [disabled]="!hasPrevPage" class="page-btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
            上一頁
        </button>
        <span class="page-info">第 {{ currentPage + 1 }} 頁，共 {{ totalPages }} 頁（共 {{ totalElements }} 筆）</span>
        <button (click)="onPageChange(currentPage + 1)" [disabled]="!hasNextPage" class="page-btn">
            下一頁
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        </button>
    </div>
</div>
