@if (isLoginPage) {
<router-outlet></router-outlet>
} @else {
<div class="app-container" [class.sidebar-collapsed]="!isSidebarActive">
  <!-- 頂部導航欄 -->
  <div class="top-header">
    <div class="header-right">
      @if(isPCMenuToggleEnabled){
      <!-- 主機端漢堡菜單按鈕 -->
      <button class="pc-menutoggle" aria-label="Toggle mobile menu" (click)="toggleSidebar()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
      }

      <div class="logo-text">
        <span>{{ 'COMMON.SYSTEM_NAME' | translate }}</span>
      </div>
    </div>
    <div class="header-right">
      @if (isMobileMenuToggleEnabled) {
      <!-- 手機端漢堡菜單按鈕 -->
      <button class="mobile-menu-toggle" aria-label="Toggle mobile menu" (click)="toggleSidebar()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
      }

      <!-- <app-refresh-token-test></app-refresh-token-test> -->
      <!-- <app-language-selector></app-language-selector> -->
      <app-user-menu-dropdown
        [userName]="userName"
        [userRole]="userRole"
        [avatarUrl]="avatarUrl"
        [showDefaultAvatar]="showDefaultAvatar"
        (logoutEvent)="logout()"
      ></app-user-menu-dropdown>
    </div>
  </div>


  <!-- 主體內容區域 -->
  <div class="main-container">
    <!-- 側邊欄 -->
    <div class="sidebar" [class.active]="isSidebarActive">
      <!-- 用戶資料 -->
      <div class="user-profile">
        <div class="avatar-container">
          <img *ngIf="!showDefaultAvatar && avatarUrl" [src]="avatarUrl" alt="User Avatar" width="50" height="50"
            (error)="handleAvatarError()" />
          <svg *ngIf="showDefaultAvatar || !avatarUrl" xmlns="http://www.w3.org/2000/svg" width="50" height="50"
            viewBox="0 0 50 50">
            <circle cx="25" cy="25" r="25" fill="#f0f0f0" />
            <circle cx="25" cy="20" r="8" fill="#999" />
            <path d="M25,28 C17,28 11,32 11,38 L39,38 C39,32 33,28 25,28 Z" fill="#999" />
          </svg>
        </div>
        <div class="user-info">
          <div class="user-name">{{ userName }}</div>
          <div class="user-role">{{ userRole || "_" }}</div>
        </div>
        <button class="menu-toggle" aria-label="Toggle sidebar" (click)="toggleSidebar()">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#FF5733" stroke="currentColor"
            stroke-width="2" viewBox="0 0 16 16">
            @if (isMenuToggleOffVisible){
            <path *ngIf="!isSidebarActive"
              d="M5.5 8a.5.5 0 0 1 .5-.5h6.293l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708.708L12.293 8.5H6a.5.5 0 0 1-.5-.5z" />
            }
            @if (isMenuToggleOnVisible){
            <path *ngIf="isSidebarActive"
              d="M10.5 8a.5.5 0 0 1-.5.5H3.707l3.147 3.146a.5.5 0 0 1-.708.708l-4-4a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L3.707 7.5H10a.5.5 0 0 1 .5.5z" />
            }
          </svg>
        </button>
      </div>

      <!-- 導航菜單 -->
      <div class="nav-menu">
        <ul>
          <li>
            <a routerLink="/home" routerLinkActive="active">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="lucide lucide-home-icon lucide-home">
                <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                <polyline points="9,22 9,12 15,12 15,22" />
              </svg> <span>{{ 'SIDEBAR.HOME' | translate }}</span>
            </a>
          </li>

          <!-- 資產管理選項 -->
          <li class="menu-item-with-submenu">
            <a href="javascript:void(0)" (click)="toggleSubmenu('assetManagement')">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="lucide lucide-package-icon lucide-package">
                <path
                  d="M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z" />
                <path d="M12 22V12" />
                <polyline points="3.29 7 12 12 20.71 7" />
                <path d="m7.5 4.27 9 5.15" />
              </svg>
              <span>{{ 'SIDEBAR.ASSET_MANAGEMENT' | translate }}</span>
              <svg class="submenu-arrow" [class.rotated]="isSubmenuExpanded('assetManagement')"
                xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path fill-rule="evenodd"
                  d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z" />
              </svg>
            </a>
            <ul class="submenu" [class.active]="isSubmenuExpanded('assetManagement')">
             <li>
                <a routerLink="/asset-management/add" routerLinkActive="active">
                     <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    viewBox="0 0 16 16">
                    <path d="M8 3.5a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h1.5V4a.5.5 0 0 1 .5-.5z" />
                    <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm8-9a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" />
                    <path d="M12.5 3a.5.5 0 0 1 .5.5v5a.5.5 0 0 1-1 0v-5a.5.5 0 0 1 .5-.5z" />
                    <path d="M10.5 5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 1-.5-.5z" />
                  </svg>
                  <span>{{ 'SIDEBAR.ASSET_ADD' | translate }}</span>
                </a>
              </li>
            </ul>
          <!-- </li>
            <a routerLink="/profile" routerLinkActive="active">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path
                  d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z" />
              </svg>
              <span>{{ 'SIDEBAR.SETTING' | translate }}</span>
            </a>
          <li> -->
            <a href="javascript:void(0)" (click)="logout()">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path fill-rule="evenodd"
                  d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0v2z" />
                <path fill-rule="evenodd"
                  d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z" />
              </svg>
              <span>{{ 'COMMON.LOGOUT' | translate }}</span>
            </a>
          </li>
        </ul>
        <!-- 移動端滑動空間容器 -->
        <div class="mobile-scroll-spacer"></div>
      </div>

    </div>


    <!-- 主要內容 -->
    <div class="main-content">
      <div class="content-wrapper">
        <router-outlet></router-outlet>
      </div>
    </div>

    <!-- 路由導航加載動畫 -->
    <app-loading-spinner
      [isLoading]="isNavigating"
      [text]="'SIDEBAR.LOADING_TEXT' | translate">
    </app-loading-spinner>
  </div>
</div>

<!-- 登錄頁面模板 -->
<ng-template #loginTemplate>
  <router-outlet></router-outlet>
</ng-template>
}
